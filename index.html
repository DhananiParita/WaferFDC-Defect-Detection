<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wafer Defect Detective</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%2318181b%22 rx=%2220%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22none%22 stroke=%22%23ffffff%22 stroke-width=%228%22/><path d=%22M50 20 L50 80 M20 50 L80 50%22 stroke=%22%23ffffff%22 stroke-width=%224%22/></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #ffffff;
            --surface: #f4f4f5;
            --surface-2: #ffffff;
            --border: #e4e4e7;
            --text: #18181b;
            --text-sub: #71717a;
            --primary: #18181b;
            --inverse: #ffffff;
            --ease-smooth: cubic-bezier(0.16, 1, 0.3, 1);
        }

        [data-theme="dark"] {
            --bg: #000000;
            --surface: #111111;
            --surface-2: #1c1c1c;
            --border: #27272a;
            --text: #ededed;
            --text-sub: #a1a1aa;
            --primary: #ffffff;
            --inverse: #000000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Instrument Sans', sans-serif;
            transition: background-color 0.4s ease;
            height: 100vh;
            overflow: hidden; 
            display: flex; flex-direction: column;
        }

        header {
            padding: 20px 24px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 50;
        }

        .brand { font-weight: 600; font-size: 18px; letter-spacing: -0.02em; display: flex; align-items: center; gap: 8px; }
        .brand-badge { font-family: 'JetBrains Mono', monospace; font-size: 10px; background: var(--surface); padding: 4px 6px; border-radius: 4px; color: var(--text-sub); }

        .theme-btn {
            background: var(--surface); border: none; width: 40px; height: 40px;
            border-radius: 50%; color: var(--text); display: grid; place-items: center;
            cursor: pointer; transition: 0.2s;
        }
        .theme-btn:active { transform: scale(0.9); }

        .nav-dock {
            background: var(--surface);
            padding: 4px;
            border-radius: 100px;
            display: flex;
            gap: 4px;
        }

        .nav-btn {
            background: none; border: none; padding: 8px 24px;
            border-radius: 100px; 
            font-family: 'Instrument Sans', sans-serif;
            font-size: 14px; font-weight: 500;
            color: var(--text-sub); cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
            position: relative; overflow: hidden;
        }

        .nav-btn.active { background: var(--bg); color: var(--text); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        #mobile-dock { display: none; } 

        @media (max-width: 900px) {
            #desktop-dock { display: none; }
            #mobile-dock { 
                display: flex; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
                background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                z-index: 9999; padding: 6px; gap: 5px; width: auto; min-width: 280px; justify-content: center;
            }
            [data-theme="light"] #mobile-dock { background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,0,0.1); }
            .nav-btn { color: rgba(255,255,255,0.6); padding: 14px 20px; flex: 1; font-size: 14px; }
            .nav-btn.active { background: var(--primary); color: var(--inverse); }
            [data-theme="light"] .nav-btn { color: rgba(0,0,0,0.6); }
            [data-theme="light"] .nav-btn.active { color: var(--inverse); }
        }

        main {
            flex: 1; position: relative; width: 100%; max-width: 1200px; margin: 0 auto;
            overflow-y: auto; overflow-x: hidden; padding: 20px 24px 120px 24px;
        }
        main::-webkit-scrollbar { width: 0px; background: transparent; }

        .view {
            display: none; opacity: 0; transform: scale(0.98);
            transition: opacity 0.4s var(--ease-smooth), transform 0.4s var(--ease-smooth);
        }
        .view.active { display: block; opacity: 1; transform: scale(1); }

        .grid-layout { display: grid; grid-template-columns: 1fr 1.2fr; gap: 40px; height: 100%; }

        .upload-card {
            background: var(--surface); border-radius: 24px; position: relative; overflow: hidden; aspect-ratio: 1/1;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; border: 1px solid transparent; transition: 0.3s;
        }
        .upload-card:active { transform: scale(0.98); }
        .upload-card:hover { border-color: var(--text-sub); }

        .upload-ui { text-align: center; transition: 0.3s; }
        .upload-icon { width: 48px; height: 48px; color: var(--text-sub); margin-bottom: 16px; }

        #preview-layer { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; display: none; }

        .scanner {
            position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: var(--primary); box-shadow: 0 0 15px var(--primary);
            opacity: 0; pointer-events: none; z-index: 10;
        }
        .scanning .scanner { opacity: 1; animation: scan 0.8s infinite linear; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        .results-panel { display: flex; flex-direction: column; gap: 24px; opacity: 0.3; pointer-events: none; transition: 0.5s; filter: blur(4px); }
        .results-panel.ready { opacity: 1; pointer-events: all; filter: blur(0); }

        .metric-card { background: var(--surface); padding: 24px; border-radius: 20px; }
        .metric-label { font-family: 'JetBrains Mono', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-sub); margin-bottom: 8px; display: block; }
        
        .big-stat { font-size: 42px; font-weight: 600; letter-spacing: -1px; display: flex; justify-content: space-between; align-items: center; }
        .conf-badge { font-size: 16px; background: var(--bg); padding: 4px 12px; border-radius: 100px; font-family: 'JetBrains Mono', monospace; }

        .glossary-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .term-item {
            background: var(--surface); padding: 20px; border-radius: 16px;
            border: 1px solid transparent; transition: 0.2s;
        }
        .term-name { font-weight: 600; margin-bottom: 8px; color: var(--primary); }
        .term-def { font-size: 14px; color: var(--text-sub); line-height: 1.5; }

        .about-container { max-width: 800px; margin: 0 auto; padding-top: 20px; }
        
        .reveal-text { opacity: 0; transform: translateY(20px); animation: slideUp 0.8s var(--ease-smooth) forwards; }
        .d-1 { animation-delay: 0.1s; } .d-2 { animation-delay: 0.2s; } .d-3 { animation-delay: 0.3s; }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 40px; }
        .avatar { width: 70px; height: 70px; background: var(--surface); border-radius: 50%; display: grid; place-items: center; font-size: 30px; }
        
        .about-section-title { font-size: 16px; font-weight: 600; color: var(--text); margin-bottom: 12px; margin-top: 40px; }
        .about-text { color: var(--text-sub); line-height: 1.7; font-size: 15px; max-width: 90%; }

        .tech-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-top: 20px; }
        .tech-item { 
            background: var(--surface); padding: 16px; border-radius: 12px; 
            font-size: 13px; font-weight: 500; display: flex; flex-direction: column; gap: 8px;
        }
        .tech-icon { width: 20px; height: 20px; color: var(--text); }

        @media (max-width: 900px) {
            .grid-layout { grid-template-columns: 1fr; height: auto; gap: 24px; }
            .upload-card { aspect-ratio: 16/9; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">WaferFDC <span class="brand-badge">BETA</span></div>
        
        <div class="nav-dock" id="desktop-dock">
            <button class="nav-btn active" onclick="go('detect')">Analyze</button>
            <button class="nav-btn" onclick="go('glossary')">Glossary</button>
            <button class="nav-btn" onclick="go('about')">About</button>
        </div>

        <button class="theme-btn" onclick="toggleTheme()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </button>
    </header>

    <main>
        <section id="detect" class="view active">
            <div class="grid-layout">
                <div class="upload-card" id="upload-zone" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" hidden onchange="handleFile(this)">
                    <div class="scanner" id="scanner"></div>
                    <img id="preview-layer" src="" alt="">
                    
                    <div class="upload-ui" id="upload-ui">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        <div style="font-weight: 500;">Tap to Upload</div>
                        <div style="font-size: 13px; color: var(--text-sub); margin-top: 4px;">Wafer Map Image</div>
                    </div>
                </div>

                <div class="results-panel" id="res-panel">
                    <div class="metric-card">
                        <span class="metric-label">Classification Result</span>
                        <div class="big-stat">
                            <span id="res-class">--</span>
                            <span class="conf-badge" id="res-conf">0%</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <span class="metric-label">Probability Analysis</span>
                        <div style="height: 250px; width: 100%;">
                            <canvas id="probChart"></canvas>
                        </div>
                    </div>

                    <div class="metric-card">
                        <span class="metric-label">Engineering Diagnosis</span>
                        <p class="insight-text" id="res-cause">
                            Awaiting input. Upload a wafer map to initiate ResNet-18 analysis.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="glossary" class="view">
            <h2 style="margin-bottom: 20px;">Defect Dictionary</h2>
            <div class="glossary-grid" id="glossary-grid"></div>
        </section>

        <section id="about" class="view">
            <div class="about-container">
                <div class="profile-header reveal-text d-1">
                    <div class="avatar">üë©‚Äçüíª</div>
                    <div>
                        <h2 style="font-size: 22px; font-weight: 600;">Dhanani Parita</h2>
                        <div style="color: var(--text-sub); font-size: 14px;">Computer Engineering ‚Ä¢ 3rd Year</div>
                    </div>
                </div>

                <div class="reveal-text d-2">
                    <h3 class="about-section-title">Project Mission</h3>
                    <p class="about-text">
                        In sub-10nm semiconductor nodes, yield is the definitive metric for profitability. Defects on wafers form specific spatial patterns that indicate upstream equipment failure. 
                        My goal is to bridge Hardware Physics and Deep Learning by automating the Fault Detection & Classification (FDC) pipeline, reducing manual inspection time by 95%.
                    </p>
                </div>

                <div class="reveal-text d-3">
                    <h3 class="about-section-title">Technical Architecture</h3>
                    <div class="tech-grid">
                        <div class="tech-item">
                            <svg class="tech-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                            <span>PyTorch CNN</span>
                        </div>
                        <div class="tech-item">
                            <svg class="tech-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>
                            <span>Flask Backend</span>
                        </div>
                        <div class="tech-item">
                            <svg class="tech-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                            <span>ResNet-18</span>
                        </div>
                        <div class="tech-item">
                            <svg class="tech-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                            <span>WM-811K Data</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="nav-dock" id="mobile-dock">
        <button class="nav-btn active" onclick="go('detect')">Detect</button>
        <button class="nav-btn" onclick="go('glossary')">Glossary</button>
        <button class="nav-btn" onclick="go('about')">About</button>
    </div>

    <script>
        const glossaryData = [
            {t: "Scratch", d: "Linear damage from robotic handling or CMP error."},
            {t: "Donut", d: "Ring defect near center. Thermal annealing unevenness."},
            {t: "Edge-Ring", d: "Outer perimeter failure. Etching plasma uniformity issue."},
            {t: "Center", d: "Cluster at core. CVD gas flow obstruction."},
            {t: "Loc", d: "Localized blob. Droplet or particle contamination."},
            {t: "Random", d: "Stochastic noise. Cleanroom air quality failure."},
            {t: "Near-full", d: "Catastrophic process failure or machine stop."},
            {t: "None", d: "Nominal yield. Pass."}
        ];

        const grid = document.getElementById('glossary-grid');
        glossaryData.forEach(i => {
            grid.innerHTML += `<div class="term-item"><div class="term-name">${i.t}</div><div class="term-def">${i.d}</div></div>`
        });

        function go(id) {
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('active');
                if(b.innerText.toLowerCase().includes(id) || (id === 'detect' && b.innerText.includes('Detect'))) b.classList.add('active');
            });

            document.querySelectorAll('.view').forEach(v => {
                v.style.opacity = '0'; v.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    v.classList.remove('active');
                    if(v.id === id) { v.classList.add('active'); void v.offsetWidth; v.style.opacity = '1'; v.style.transform = 'scale(1)'; }
                }, 200);
            });
        }

        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? 'light' : 'dark');
            if(myChart) {
                myChart.data.datasets[0].backgroundColor = isDark ? '#ffffff' : '#18181b';
                myChart.scales.x.ticks.color = isDark ? '#a1a1aa' : '#71717a';
                myChart.update();
            }
        }

        let myChart = null;

        function handleFile(input) {
            const file = input.files[0];
            if(!file) return;

            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('preview-layer').src = e.target.result;
                document.getElementById('preview-layer').style.display = 'block';
                document.getElementById('upload-ui').style.opacity = '0';
                document.getElementById('upload-zone').classList.add('scanning');
            };
            reader.readAsDataURL(file);

            runAnalysis(file);
        }

        async function runAnalysis(file) {
            const formData = new FormData();
            formData.append("file", file);

            try {
                const res = await fetch("http://127.0.0.1:5000/predict", { method: "POST", body: formData });
                const data = await res.json();

                setTimeout(() => {
                    document.getElementById('upload-zone').classList.remove('scanning');
                    
                    const panel = document.getElementById('res-panel');
                    panel.classList.add('ready');

                    document.getElementById('res-class').innerText = data.class;
                    document.getElementById('res-conf').innerText = data.confidence + "%";
                    document.getElementById('res-cause').innerText = data.cause;

                    renderChart(data.graph_data);
                }, 800); 

            } catch(e) {
                document.getElementById('upload-zone').classList.remove('scanning');
                alert("Server Error: Ensure python server.py is running.");
            }
        }

        function renderChart(data) {
            const ctx = document.getElementById('probChart').getContext('2d');
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const color = isDark ? '#ffffff' : '#18181b';
            const textColor = isDark ? '#a1a1aa' : '#71717a';

            if(myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Probability',
                        data: Object.values(data),
                        backgroundColor: color,
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { 
                            display: true,
                            ticks: { color: textColor, font: { family: 'JetBrains Mono', size: 10 }, maxRotation: 45, minRotation: 45 },
                            grid: { display: false }
                        },
                        y: { display: false }
                    },
                    animation: { duration: 800, easing: 'easeOutQuart' }
                }
            });
        }
    </script>
</body>
</html>